#!/usr/bin/env bash
set -Eeuo pipefail

LIB="$HOME/.config/theme-system/lib"

source "$LIB/core.sh"
source "$LIB/theme.sh"
source "$LIB/waybar.sh"

theme="$(get_theme)"

link() {
    local src="$1"
    local dst="$2"
    [[ -f "$src" ]] && ln -sfn "$src" "$dst"
}

restart_service() {
    systemctl --user restart "$1" 2>/dev/null || true
}

# GTK
link "$HOME/.config/gtk-3.0/gtk-$theme.css" "$HOME/.config/gtk-3.0/gtk.css"
link "$HOME/.config/gtk-4.0/gtk-$theme.css" "$HOME/.config/gtk-4.0/gtk.css"

# swaync
link "$HOME/.config/swaync/style-$theme.css" "$HOME/.config/swaync/style.css"

# hyprlock
link "$HOME/.config/hypr/hyprlock-$theme.conf" "$HOME/.config/hypr/hyprlock.conf"

# fuzzel
link "$HOME/.config/fuzzel/fuzzel-$theme.ini" "$HOME/.config/fuzzel/fuzzel.ini"

apply_waybar

restart_service swaync.service

notify "Theme applied â†’ $theme"
